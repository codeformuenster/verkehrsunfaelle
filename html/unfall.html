<html lang="de-de" dir="ltr">

  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>CodeForMuenster.org</title>
      <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
      <link rel="apple-touch-icon-precomposed" href="images/apple-touch-icon.png">
      <link rel="stylesheet" href="/css/c4m.css">
      <link rel="stylesheet" href="/uikit/css/uikit.gradient.min.css">
      <link rel="stylesheet" href="/uikit/css/tooltip.gradient.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
      <script src="/uikit/js/uikit.min.js"></script>
      <script src="/uikit/js/tooltip.js"></script>

      <style>
      .layerClick {
        margin:2px 0;
        padding:3px 20px;
        background-color:#ddd;
        border-radius:5px;
        cursor:pointer;
      }
      </style>
  </head>

  <body>
      <div class="uk-container uk-container-center uk-margin-top uk-margin-large-bottom">

          <nav class="uk-navbar uk-margin-large-bottom">
              <a class="uk-navbar-brand uk-hidden-small" href="/index.html"><img style="height:40px" src="http://codeformuenster.org/img/cfm_logo.png" /></a>
              <ul class="uk-navbar-nav uk-hidden-small">
                  <li>
                      <a href="/index.html">Startseite</a>
                  </li>
                  <li>
                      <a href="/index.html#projekte"> Projekte</a>
                  </li>
                  <li>
                      <a target="_blank" href="http://www.meetup.com/OK-Lab-Munster/"><i class="uk-icon-external-link"></i> Nächstes Treffen (meetup.com)</a>
                  </li>
                  <li>
                      <a target="_blank" href="https://github.com/codeformuenster/"><i class="uk-icon-external-link"></i> Quellcode auf Github</a>
                  </li>
              </ul>
              <a href="#offcanvas" class="uk-navbar-toggle uk-visible-small" data-uk-offcanvas></a>
              <div class="uk-navbar-brand uk-navbar-center uk-visible-small">Code For Münster</div>
          </nav>

          <h1 class="uk-text-center">Verkehrsunfall Nr <span id="unfall_id"></span></h1>

        <div  class="uk-grid"  data-uk-grid-margin>
          <div class="uk-width-medium-1-1">
            <p>Dies ist der Unfall-Eintrag aus den Daten der Polizei. Die Bezeichner sind teilweise zusammengelegt. Leider kennen wir die Bedeutung teilweise auch nicht. Für Hinweise wären wir sehr dankbar! Die Rohdaten können nach Jahr sortiert <a href="https://github.com/codeformuenster/open-data/tree/master/Unfallstatistiken2007-2014/Rohdaten" target="_blank">heruntergeladen</a> werden.</p>
            <a href="index.html">Zurück zur Verbesserungs-Karte</a>
          </div>
          <div class="uk-width-medium-1-1">
            <p id="info_table"></p>
            <table class="uk-table uk-table-striped uk-table-condensed">
              <thead>
                <tr>
                  <th>Bezeichner</th>
                  <th>Wert</th>
                  <th>Beschreibung</th>
                </tr>
              </thead>
              <tbody id="unfall_table">
              </tbody>
            </table>
          </div>



        </div>

    </div>
        </div>


        <!-- mobile navigation -->
        <div id="offcanvas" class="uk-offcanvas">
            <div class="uk-offcanvas-bar">
                <ul class="uk-nav uk-nav-offcanvas">
                  <li class="uk-active">
                      <a href="/index.html">CodeForMuenster.Org</a>
                  </li>
                    <li>
                        <a href="/index.html"> Startseite </a>

                    </li>
                    <li>
                        <a target="_blank" href="http://www.meetup.com/OK-Lab-Munster/"><i class="uk-icon-external-link"></i> Nächstes Treffen (meetup.com)</a>

                    </li>
                    <li>
                        <a target="_blank" href="https://github.com/codeformuenster/"><i class="uk-icon-external-link"></i> Quellcode auf Github</a>

                    </li>
                </ul>
            </div>
        </div>

        <!-- github ribbon -->
        <a href="https://github.com/codeformuenster"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>


        <div class="tm-footer">
            <div class="uk-container uk-container-center uk-text-center">

                <ul class="uk-subnav uk-subnav-line uk-flex-center">
                    <li><a href="https://github.com/codeformuenster">GitHub</a></li>
                    <li><a href="https://github.com/codeformuenster/codeformuenster/issues">Issues</a></li>
                    <li><a href="https://github.com/orgs/codeformuenster/people">Komplette Mitgliederliste</a></li>
                    <li><a href="https://twitter.com/codeformuenster">Twitter</a></li>
                    <li><a href="/impressum/index.html">Impressum</a></li>
                </ul>

                <div class="uk-panel">
                  <p> <!-- some text could be here --></p>
                    <a href="http://codeformuenster.org"><img src="http://codeformuenster.org/img/cfm_logo.png"></a>
                </div>

            </div>
        </div>
        <script>
          var baseUrl = "http://localhost:3000";
          // http://stackoverflow.com/a/5448595
          function getParameterValue(val) {
              var result = "",
                  tmp = [];
              var items = location.search.substr(1).split("&");
              for (var index = 0; index < items.length; index++) {
                  tmp = items[index].split("=");
                  if (tmp[0] === val) result = decodeURIComponent(tmp[1]);
              }
              return result;
          }

          // http://stackoverflow.com/a/1026087
          function capitalizeFirstLetter(string) {
              return string.charAt(0).toUpperCase() + string.slice(1);
          }

          var keyDescriptions = {
            "id": "Fortlaufende Nummer",
            "vu_ort": "Ort",
            "vu_hoehe": "Zusatzinformation zum Ort",
            "tag": "Wochentag",
            "datum": "",
            "uhrzeit": "",
            "kat": "?",
            "flucht": "",
            "row_t": "?",
            "sv":"?",
            "lv":"?",
            "anzahl_beteiligte":"",
            "fg":"?",
            "rf":"?",
            "mofa":"",
            "kkr":"Kleinkraftrad",
            "kkrad":"Kleinkraftrad",
            "pkw":"Auto",
            "lkw":"",
            "kom": "Kraftomnibus",
            "sonstige":null,
            "1":"?",
            "2":"?",
            "alkohol":"",
            "typ":"?",
            "1_urs":"1. Ursache",
            "2_urs":"2. Ursache",
            "3_urs":"3. Ursache",
            "sonst_urs":"sonstige Ursache",
            "lichtverhaeltnisse":"",
            "strassenzustand":"",
            "01_alter_in_jahren":"",
            "kinder":"",
            "18_24":"",
            "senioren":""
          };

          (function() {
              var tableElement = document.getElementById("unfall_table");
              var tableInfo = document.getElementById("info_table");

              function ajaxFail () {
                UIkit.modal.alert("Fehler beim laden oder speichern. Dies sollte eigentlich nicht passieren. Bitte melde dich bei <a href=\"https://twitter.com/ubergesundheit\">@ubergesundheit auf Twitter</a>");
                tableInfo.textContent = "Fehler :(";
              }

              // load remote json data
              function loadUnfallJson() {

                var id = getParameterValue("unfall_id");
                if (id !== "") {
                  tableInfo.textContent = "wird geladen...";

                  $.ajax( baseUrl + "/unfaelle_raw?id=eq." + id, {
                    dataType: "json",
                    headers: {
                      "Prefer": "plurality=singular"
                    }
                  })
                  .done(function( data ) {
                      console.log("got data", data);

                      Object.keys(data).forEach(function (key) {

                          var tr = document.createElement("tr");

                          var des_td = document.createElement("td");
                          var key_td = document.createElement("td");
                          var val_td = document.createElement("td");
                          tr.appendChild(key_td);
                          tr.appendChild(val_td);
                          tr.appendChild(des_td);

                          tableElement.appendChild(tr);

                          key_td.classList.add("unfall_key");

                          key_td.textContent = capitalizeFirstLetter(key);
                          val_td.textContent = data[key];
                          des_td.textContent = keyDescriptions[key];
                      });

                      tableInfo.textContent = ""
                      document.getElementById("unfall_id").textContent = id;

                  })
                  .fail(ajaxFail);
                } else {
                  tableInfo.textContent = "keine Unfall id angegeben";
                }
              }
              // initial json load
              loadUnfallJson();

            })();
        </script>
    </body>

</html>
